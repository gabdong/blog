(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{3331:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/postEditor/[type]",function(){return n(2366)}])},2750:function(e,t,n){"use strict";n.d(t,{I:function(){return uploadImage}});var a=n(8175);async function uploadImage(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,{name:r,size:i}=n;try{let o=await a.Z.get("/apis/images/",{params:{name:r,size:i}});if(o.data.url)e=o.data.url,l=o.data.alt,t=o.data.idx,alert("중복된 이미지가 있어 정보를 불러옵니다.");else{let i=new FormData;i.append("image",n),i.append("alt",null!=l?l:r),i.append("checkAuth",!0);let o=await a.Z.post("/apis/images",i);e=o.data.url,t=o.data.idx,l=o.data.alt}return{url:e,alt:l,idx:t}}catch(e){e.response.data.msg?alert(e.response.data.msg):415==e.response.status?alert("잘못된 확장자입니다."):alert("이미지 업로드를 실패하였습니다.")}}},4686:function(e,t,n){"use strict";n.d(t,{UI:function(){return getPostList},dq:function(){return editPost},fR:function(){return deletePost},lT:function(){return uploadPost}});var a=n(8175),l=n(2750);async function getPostList(e,t,n,l){try{let r=await a.Z.get("/apis/posts/list/".concat(e),{params:{limit:n,page:t,paginationUsing:l}});return r.data}catch(e){console.error(e.response.data.msg)}}async function deletePost(e,t){if(window.confirm("게시글 삭제를 진행하시겠습니까?"))try{await a.Z.delete("/apis/posts/".concat(e)),t.push("/")}catch(e){console.error(e.response.data.msg)}}async function uploadPost(e){if(e.uploadThumbnail){let{uploadThumbnail:n,thumbnailAlt:r}=e;try{let t=await (0,l.I)(n,r),i=t.idx;e.thumbnail=i,await a.Z.post("/apis/posts",{checkAuth:!0,postData:e})}catch(e){var t;(null===(t=e.response)||void 0===t?void 0:t.data.msg)&&console.error(e.response.data.msg)}}}async function editPost(e){try{let t=await (0,l.I)(uploadThumbnail,thumbnailAlt),n=t.idx;e.thumbnail=n,await a.Z.post("/apis/posts/".concat(e.postIdx),{checkAuth:!0,postData:e})}catch(e){var t;(null===(t=e.response)||void 0===t?void 0:t.data.msg)&&console.error(e.response.data.msg)}}n(279)},2366:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return b},default:function(){return PostEditor}});var a=n(5059),l=n(8598),r=n(2684),i=n(9518),o=n(4686),c=n(8096),s=n(2035);function elDisplayToggle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"remove",a=!(arguments.length>3)||void 0===arguments[3]||arguments[3];function _toggleFn(a){let l=document.getElementById(t),r=a.target,i=!1;for(let t of e)(r.closest("#".concat(t))||r.id===t)&&(i=!0);i||("remove"==n?l.remove():l.classList.remove(n),document.removeEventListener("click",_toggleFn))}e=e||[],t=t||"",n=n||"",(a=null==a||a)?document.addEventListener("click",_toggleFn):document.removeEventListener("click",_toggleFn)}n(1514),n(2083);var u=n(1774),d=n.n(u),p=n(3638),m=n(2750);let f=d()(()=>n.e(422).then(n.bind(n,7422)),{loadableGenerated:{webpack:()=>[7422]},ssr:!1});function Editor(e){let{...t}=e;async function onImagePasted(e){let n=e.files.length;for(let a=0;a<n;a++){let n=e.files.item(a);if(n)try{let{url:e,alt:a}=await (0,m.I)(n),l=function(e,t){let n=document.querySelector(e);if(!n)return null;let a=n.value,l=a.length,r=n.selectionStart,i=n.selectionEnd,o=a.slice(0,r),c=a.slice(r,l);return a="".concat(o," ").concat(t," ").concat(c),n.value=a,n.selectionEnd=i+t.length+2,a}(".w-md-editor-text-input","![".concat(null!=a?a:n.name,"](").concat(e,")"));if(!l)continue;t.onChange(l)}catch(e){}}}return(0,l.jsx)("div",{"data-color-mode":"dark",children:(0,l.jsx)(f,{value:t.value,onChange:t.onChange,height:t.height,previewOptions:{rehypePlugins:[[p.Z]]},onPaste:async e=>{e.clipboardData.files.length>0&&e.preventDefault(),await onImagePasted(e.clipboardData)}})})}var g=n(169),h=n(1809);let{useRef:v}=n(2684);function SearchInput(e){let t,n,{...a}=e,i=function(){let e=v(!0),t=e.current;return e.current=!1,t}();return(a.defaultValue||""===a.defaultValue)&&a.setDefaultValue&&"function"==typeof a.setDefaultValue?(t=a.defaultValue,n=a.setDefaultValue,(0,r.useEffect)(()=>{let e=setTimeout(()=>{"function"!=typeof a.searchFunc||i||a.searchFunc(t)},300);return()=>clearTimeout(e)},[t]),(0,l.jsx)(g.Z,{...a,onChange:e=>n(e.target.value),onKeyUp:e=>n(e.target.value),defaultValue:t})):console.error("<SearchInput> 검색어 state가 없습니다.")}function _templateObject(){let e=(0,a._)(["\n  display: flex;\n  flex-direction: column;\n  gap: 25px;\n\n  width: 100%;\n"]);return _templateObject=function(){return e},e}function _templateObject1(){let e=(0,a._)(["\n  display: flex;\n  align-items: center;\n  gap: 8px;\n"]);return _templateObject1=function(){return e},e}function _templateObject2(){let e=(0,a._)(["\n  padding: var(--small-box-padding);\n  border-radius: var(--border-radius);\n  background: var(--dark-l-o);\n  transition: var(--transition);\n  cursor: pointer;\n\n  & > .caption {\n    color: var(--primary-color-d-text);\n  }\n  &:hover {\n    background: var(--dark-l);\n  }\n"]);return _templateObject2=function(){return e},e}function _templateObject3(){let e=(0,a._)(["\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n"]);return _templateObject3=function(){return e},e}function _templateObject4(){let e=(0,a._)(["\n  height: 120px;\n  padding: 8px;\n  border: 1px solid #dddddd;\n  border-radius: var(--border-radius);\n"]);return _templateObject4=function(){return e},e}function _templateObject5(){let e=(0,a._)(["\n  height: 100%;\n"]);return _templateObject5=function(){return e},e}function _templateObject6(){let e=(0,a._)(["\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  width: 100%;\n  position: relative;\n"]);return _templateObject6=function(){return e},e}function _templateObject7(){let e=(0,a._)(["\n  display: none;\n  gap: 8px;\n\n  width: 100%;\n  padding: var(--box-padding);\n  background: var(--dark);\n  border: 1px solid var(--gray);\n  border-radius: var(--border-radius);\n  position: absolute;\n  top: calc(100% + 10px);\n\n  &.active {\n    display: flex;\n    align-items: center;\n    flex-wrap: wrap;\n    z-index: 1;\n  }\n"]);return _templateObject7=function(){return e},e}function _templateObject8(){let e=(0,a._)(["\n  cursor: pointer;\n\n  & > .normalText {\n    transition: var(--transition);\n  }\n  &:hover > .normalText {\n    color: var(--primary-color);\n  }\n"]);return _templateObject8=function(){return e},e}function _templateObject9(){let e=(0,a._)(["\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n"]);return _templateObject9=function(){return e},e}function _templateObject10(){let e=(0,a._)(["\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n"]);return _templateObject10=function(){return e},e}function _templateObject11(){let e=(0,a._)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n\n  width: 100%;\n"]);return _templateObject11=function(){return e},e}function _templateObject12(){let e=(0,a._)(["\n  display: flex;\n  align-items: center;\n  gap: 10px;\n"]);return _templateObject12=function(){return e},e}var b=!0;function PostEditor(e){var t,n,a,i,u,d,p;let{pageProps:m}=e,{gsspProps:{postData:f}}=m,v=null!==(t=null==f?void 0:f.idx)&&void 0!==t?t:"",[b,E]=(0,r.useState)(null!==(n=null==f?void 0:f.thumbnail)&&void 0!==n?n:""),[N,D]=(0,r.useState)(null!==(a=null==f?void 0:f.thumbnailAlt)&&void 0!==a?a:""),[R,A,V]=(0,s.Z)(null!==(i=null==f?void 0:f.subject)&&void 0!==i?i:""),[F,L]=(0,r.useState)(null!==(u=null==f?void 0:f.content)&&void 0!==u?u:""),[q,U]=(0,r.useState)(null!==(d=null==f?void 0:f.tagData)&&void 0!==d?d:[]),[W,X]=(0,r.useState)(null!==(p=null==f?void 0:f.tags)&&void 0!==p?p:[]),[z,B]=(0,r.useState)([]),[G,K]=(0,r.useState)(""),[Y,H]=(0,r.useState)(null),J=(0,r.useRef)(null),M=(0,r.useRef)(null);(0,r.useEffect)(()=>{"edit"==m.urlParams.type&&f.subject!=R?(V(f.subject),L(f.content),U(f.tagData),X(f.tags),E(f.thumbnail),D(f.thumbnailAlt)):"new"==m.urlParams.type&&R&&(V(""),L(),U([]),X([]),E(""),D(""))},[m.urlParams]);let getSearchTagResult=async e=>{if(e){let t=await (0,c.CN)(e,W);Array.isArray(t)?B(t):B([]),J.current.classList.add("active"),elDisplayToggle(["searchTagResultWrap","searchTagInput"],"searchTagResultWrap","active",!0)}else J.current.classList.remove("active"),elDisplayToggle(null,null,null,!1)},clickSearchTagResult=e=>{U(t=>(t.push(e),[...t])),X(t=>(t.push(e.idx),[...t])),B(t=>{let n=t.findIndex(t=>t.idx=e.idx);return -1!==n&&t.splice(n,1),[...t]})},savePost=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Y",t={isPublic:e,subject:R,content:F,tags:W,uploadThumbnail:Y,thumbnailAlt:N};console.log(t),v?(t.postIdx=v,(0,o.dq)(t)):(0,o.lT)(t)};return(0,l.jsxs)(x,{children:[(0,l.jsx)(j,{ref:M,children:q.length>0?q.map(e=>(0,l.jsx)(_,{children:(0,l.jsxs)("span",{className:"caption",children:["#",e.name]})},e.idx)):null}),(0,l.jsxs)(P,{children:[(0,l.jsx)("h3",{className:"smallTitle",children:"태그"}),(0,l.jsx)(SearchInput,{searchFunc:e=>getSearchTagResult(e),border:"bottom",style:{width:"100%",color:"var(--gray-l)"},placeholder:"검색",onFocus:e=>getSearchTagResult(e.target.value),id:"searchTagInput",defaultValue:G,setDefaultValue:K}),(0,l.jsx)(I,{ref:J,id:"searchTagResultWrap",className:G?"active":"noActive",children:z.length>0?z.map(e=>(0,l.jsx)(T,{onClick:t=>{t.stopPropagation(),clickSearchTagResult(e)},children:(0,l.jsx)("span",{className:"normalText",children:e.name})},e.idx)):(0,l.jsx)("span",{className:"normalText",children:"검색 결과가 없습니다."})})]}),(0,l.jsxs)(y,{children:[(0,l.jsx)("h3",{className:"smallTitle",children:"썸네일"}),(0,l.jsx)(g.Z,{type:"file",border:"bottom",accept:"image/jpeg, image/jpg, image/png, image/gif",onChange:e=>{let t=e.target.files[0];if(!["image/png","image/jpg","image/jpeg","image/gif"].includes(t.type))return alert("잘못된 확장자입니다.");let n=new FileReader;n.readAsDataURL(t),n.onload=()=>{E(n.result),H(t)}}}),(0,l.jsx)(g.Z,{defaultValue:N,onChange:e=>D(e.target.value),border:"bottom",style:{color:"var(--gray-l)"},placeholder:"썸네일 설명"}),(0,l.jsx)(w,{children:b?(0,l.jsx)(O,{id:"thumbnail",src:b,alt:N}):null})]}),(0,l.jsxs)(Z,{children:[(0,l.jsx)("h3",{className:"smallTitle",children:"제목"}),(0,l.jsx)(g.Z,{defaultValue:R,onChange:A,border:"bottom",style:{color:"var(--gray-l)"},placeholder:"입력"})]}),(0,l.jsxs)(C,{children:[(0,l.jsx)("h3",{className:"smallTitle",children:"내용"}),(0,l.jsx)(Editor,{value:F,onChange:L,height:"500"})]}),(0,l.jsxs)(k,{children:[(0,l.jsx)(h.Z,{text:"취소"}),(0,l.jsxs)(S,{children:[(0,l.jsx)(h.Z,{text:"비공개",onClick:()=>savePost("N")}),(0,l.jsx)(h.Z,{text:"저장",style:{background:"var(--primary-color)"},onClick:()=>savePost()})]})]})]})}let x=i.ZP.article.withConfig({componentId:"sc-94fdaca9-0"})(_templateObject()),j=i.ZP.div.withConfig({componentId:"sc-94fdaca9-1"})(_templateObject1()),_=i.ZP.div.withConfig({componentId:"sc-94fdaca9-2"})(_templateObject2()),y=i.ZP.div.withConfig({componentId:"sc-94fdaca9-3"})(_templateObject3()),w=i.ZP.div.withConfig({componentId:"sc-94fdaca9-4"})(_templateObject4()),O=i.ZP.img.withConfig({componentId:"sc-94fdaca9-5"})(_templateObject5()),P=i.ZP.div.withConfig({componentId:"sc-94fdaca9-6"})(_templateObject6()),I=i.ZP.div.withConfig({componentId:"sc-94fdaca9-7"})(_templateObject7()),T=i.ZP.div.withConfig({componentId:"sc-94fdaca9-8"})(_templateObject8()),Z=i.ZP.div.withConfig({componentId:"sc-94fdaca9-9"})(_templateObject9()),C=i.ZP.div.withConfig({componentId:"sc-94fdaca9-10"})(_templateObject10()),k=i.ZP.div.withConfig({componentId:"sc-94fdaca9-11"})(_templateObject11()),S=i.ZP.div.withConfig({componentId:"sc-94fdaca9-12"})(_templateObject12())}},function(e){e.O(0,[1,774,888,179],function(){return e(e.s=3331)}),_N_E=e.O()}]);